FROM node:10.16.3-alpine

ADD . /tmp
WORKDIR /tmp

RUN npm install -g serve
RUN npm ci

ARG REACT_APP_INSTRUMENTATION_KEY
ARG TRAEFIK_PUBLIC_NETWORK
ARG REACT_APP_API_URL
ARG ENVIRONMENT
ARG NODE_ENV

ENV PUBLIC_URL=.

RUN npm run build

RUN npm run webpack:prod

RUN mv /tmp/build /app
WORKDIR /app

ENV REACT_APP_CORTEXIA_VERSION=$BUILDTIME_CORTEXIA_VERSION
EXPOSE 5000

CMD serve -s .
